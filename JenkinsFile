pipeline {
  agent any

  options {
    ansiColor('xterm')
  }

   stages {
       stage('Dependencies') {
           steps {
       
               sh
                'npx cypress install --force'
              
           }
       }
        stage('e2e Tests') {
           steps {
               sh 'npx cypress run --config video=false,screenshotOnRunFailure=false --reporter junit --reporter-options "mochaFile=reports/TEST-[hash].xml"'


           
  
 }     
  }
        stage('Send Report TestRail') {
           steps {
              sh ''' 
                junitparser merge --glob "reports/TEST-*" "reports/junit-report.xml"
                trcli -y -h https://qatesterl.testrail.io/  --project "Facilia QAE" --username  rafael.cruz-exterieur@fiducial.net  --password Suz@no30  parse_junit --title "Cypress Automated Test Run" -f "./reports/junit-report.xml"
              
              
              ''' 


           }
}
}
}
