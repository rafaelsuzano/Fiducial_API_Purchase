pipeline {
  agent any

  options {
    ansiColor('xterm')
  }


   stages {
       stage('Dependencies') {
           steps {
       
               sh 'npx cypress install --force'
           }
       }
        stage('e2e Tests') {
           steps {
               sh ' npx cypress run --reporter junit --reporter-options "mochaFile=reports/TEST-[hash].xml"''

'
           }
  
   post {
    always {
     publishHTML([
        allowMissing: false,
        alwaysLinkToLastBuild: false,
        keepAll: true,
        reportDir: 'cypress/cypress/reports/html',
        reportFiles: 'index.html',
        reportName: 'HTML Report', 
        reportTitles: ''])
  }      
 }     
  }
        stage('Send Report TestRail') {
           steps {
              sh ' npx cypress run --reporter junit --reporter-options "mochaFile=reports/TEST-[hash].xml"'
           }

}
}
}