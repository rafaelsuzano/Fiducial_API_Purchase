pipeline {
  agent any

  options {
    ansiColor('xterm')
  }


   stages {
       stage('Dependencies') {
           steps {
       
               sh 'npm install cypress --save-dev'
           }
       }
       stage('e2e Tests') {
           steps {
               sh ' npm test'
           }
       }

        stage('Send Report TestRail') {
            steps {
              sh ' npx cypress run --reporter junit --reporter-options "mochaFile=reports/TEST-[hash].xml"'
           }
        

   
   post {
    always {
     publishHTML([
        allowMissing: false,
        alwaysLinkToLastBuild: false,
        keepAll: true,
        reportDir: 'cypress/cypress/reports/html',
        reportFiles: 'index.html',
        reportName: 'HTML Report', 
        reportTitles: ''])
  }      
 }     
  }
}
